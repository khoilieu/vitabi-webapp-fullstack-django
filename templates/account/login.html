{% load static %}
{% load i18n %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"/>
    <link rel="icon" href="{% static "home/favicon.png" %}" type="image/x-icon">
    <title>Login</title>
    <link rel="stylesheet" href="{% static "account/login.css" %}">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <link href="https://getbootstrap.com/docs/5.3/assets/css/docs.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Google Tag Manager -->
    	<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
			new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
			j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
			'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
			})(window,document,'script','dataLayer','GTM-NBX832CK');</script>
    <!-- End Google Tag Manager -->
     <script type="text/javascript">
        (function(c,l,a,r,i,t,y){
        c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
      t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
        y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
        })(window, document, "clarity", "script", "nqixhxf3g6");
      </script>
</head>
<style>
  .imgIcon {
    width: 65px;
    height: 40px;
    margin-bottom: 4px;
  }
</style>
  <body>
    <section>
        <header>
            <img src="{% static "home/logoVitabi.png" %}" class="imgIcon">
            <div class="dropdown">
              <form id="language-form" style="margin: 0" action="{% url 'change_language' %}" method="post">
                {% csrf_token %}
                <input type="hidden" id="next" name="next" value="{{ request.path }}">
                <a class="btn btn-secondary dropdown-toggle d-flex justify-content-center align-items-center" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                  {% if current_language == 'en' %}
                          <img src="{{ MEDIA_URL }}language_photos/englishflag.jpg" alt="{{ current_language }}" class="language-flag" style="width: 20px; height: 20px; margin-right: 5px;"><strong>EN</strong>
                        {% elif current_language == 'jp' %}
                          <img src="{{ MEDIA_URL }}language_photos/japanflag.jpg" alt="{{ current_language }}" class="language-flag" style="width: 20px; height: 20px; margin-right: 5px;"><strong>JP</strong>
                        {% elif current_language == 'vn' %}
                          <img src="{{ MEDIA_URL }}language_photos/Vietnamese_Flag.jpeg" alt="{{ current_language }}" class="language-flag" style="width: 20px; height: 20px; margin-right: 5px;"><strong>VN</strong>
                  {% endif %}
                </a>                      
                <ul class="dropdown-menu">
                  <li><button type="submit" name="language" value="en" class="dropdown-item language-option"><img src="{{ MEDIA_URL }}language_photos/englishflag.jpg" class="language-flag" style="width: 20px; height: 20px;"> English</button></li>
                  <li><button type="submit" name="language" value="jp" class="dropdown-item language-option"><img src="{{ MEDIA_URL }}language_photos/japanflag.jpg" class="language-flag" style="width: 20px; height: 20px;"> 日本語</button></li>
                  <li><button type="submit" name="language" value="vn" class="dropdown-item language-option"><img src="{{ MEDIA_URL }}language_photos/Vietnamese_Flag.jpeg" class="language-flag" style="width: 20px; height: 20px;"> Tiếng Việt</button></li>
                </ul>
              </form>
            </div>
        </header>


        <main>
            <a href=""><img src="{% static "home/logo.png" %}"  class="img"></a>
            <h2 class="mb-4" >{% trans "Login" %}</h2>
            {% if messages %}
              {% for message in messages %}
                {% if 'userError' in message.tags %}
                  <p style="color: #dc2626">{{ message }}</p>
                {% endif %}
              {% endfor %}
            {% endif %}
            <form class="form" method="POST" action="">
                {% csrf_token %}
                <input type="hidden" name="next" value="{{ request.GET.next|default:'' }}">
                <input type="text" name="email" placeholder="{% trans "Enter email" %}" value="{{ email }}" required>
                <input type="password" name="password" placeholder="{% trans "Enter password" %}" required>
                <input type="submit" id="submit" value="{% trans "Login" %}"/>
            </form>
    
            <p>{% trans "Don't have an account?" %} <a href="{% url "register" %}" style="color: #4B4B4B;">{% trans "Register" %}</a></p>
        </main>

        <div class="footer">
          <a href="{% url "home" %}" class="nav-link" style="width: 70px;">
            <svg
            xmlns="http://www.w3.org/2000/svg"
            width="16"
            height="16"
            fill="currentColor"
            class="bi bi-house"
            viewBox="0 0 16 16"
            >
            <path
            d="M8.707 1.5a1 1 0 0 0-1.414 0L.646 8.146a.5.5 0 0 0 .708.708L2 8.207V13.5A1.5 1.5 0 0 0 3.5 15h9a1.5 1.5 0 0 0 1.5-1.5V8.207l.646.647a.5.5 0 0 0 .708-.708L13 5.793V2.5a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5v1.293zM13 7.207V13.5a.5.5 0 0 1-.5.5h-9a.5.5 0 0 1-.5-.5V7.207l5-5z"
            />
            </svg>
            <span>{% trans "Home" %}</span>
          </a>
          <a href="{% url "care" %}" class="nav-link" style="width: 70px;">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="16"
              height="16"
              fill="currentColor"
              class="bi bi-calendar-event"
              viewBox="0 0 16 16"
            >
              <path
              d="M11 6.5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5z"
              />
              <path
              d="M3.5 0a.5.5 0 0 1 .5.5V1h8V.5a.5.5 0 0 1 1 0V1h1a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2h1V.5a.5.5 0 0 1 .5-.5M1 4v10a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V4z"
              />
            </svg>
            <span>{% trans "Bookings" %}</span>
          </a>
          <a href="{% url "mydata" %}" class="nav-link" style="width: 70px;">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="16"
              height="16"
              fill="currentColor"
              class="bi bi-card-list"
              viewBox="0 0 16 16"
            >
              <path
              d="M14.5 3a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-13a.5.5 0 0 1-.5-.5v-9a.5.5 0 0 1 .5-.5zm-13-1A1.5 1.5 0 0 0 0 3.5v9A1.5 1.5 0 0 0 1.5 14h13a1.5 1.5 0 0 0 1.5-1.5v-9A1.5 1.5 0 0 0 14.5 2z"
              />
              <path
              d="M5 8a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7A.5.5 0 0 1 5 8m0-2.5a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7a.5.5 0 0 1-.5-.5m0 5a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7a.5.5 0 0 1-.5-.5m-1-5a.5.5 0 1 1-1 0 .5.5 0 0 1 1 0M4 8a.5.5 0 1 1-1 0 .5.5 0 0 1 1 0m0 2.5a.5.5 0 1 1-1 0 .5.5 0 0 1 1 0"
              />
            </svg>
            <span>{% trans "My Data" %}</span>
          </a>
        </div>
        <!-- Modal -->
        {% if messages %}
        <div id="messageModal" class="modal position-absolute top-0 start-50 translate-middle mt-5" tabindex="-1"  style="display: none;">
          <div class="modal-dialog modal-dialog-centered" style="width: 370px;">
            {% for message in messages %}
              {% if 'accSuccess' in message.tags %}
                <div class="modal-content" style="background-color: #ecfccb;">
                    <div class="modal-body text-center ">
                        <p style="margin: 0"><span class="success">{{ message }}</span></p>
                    </div>
                </div>
              {% endif %}
            {% endfor %}
          </div>
        </div>
        {% endif %}
    </section>
  </body>
  {% if user.is_authenticated and user.patient.is_patient %}
	<!-- Google Tag Manager (noscript) -->
	<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NBX832CK"
		height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
		<!-- End Google Tag Manager (noscript) -->	
	{% endif %}
</html>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const languageButtons = document.querySelectorAll('.language-option');
    const nextField = document.getElementById('next');
    
    languageButtons.forEach(function(button) {
      button.addEventListener('click', function (e) {
        const currentLangPrefix = window.location.pathname.split('/')[1];
        const chosenLanguage = this.value;
        
        let newLangPrefix = chosenLanguage;
        
        const newPath = window.location.pathname.replace('/' + currentLangPrefix, '/' + newLangPrefix);
        nextField.value = window.location.origin + newPath + window.location.search;
        
        e.preventDefault();
        document.getElementById('language-form').submit();
      });
    });
  }); 

  window.onload = function() {
    const messageModal = document.getElementById('messageModal');
    if (messageModal) {
        messageModal.style.display = 'block'; 

        setTimeout(function() {
            messageModal.style.display = 'none'; 
        }, 2000);

        messageModal.addEventListener('click', function() {
          messageModal.style.display = 'none'; 
        });
    }
  };
</script>
