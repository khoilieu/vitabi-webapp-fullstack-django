{% load static %}
{% load i18n %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"/>
    <link rel="icon" href="{% static "home/favicon.png" %}" type="image/x-icon">
    <title>Book1</title>
    <link rel="stylesheet" href="{% static "home/book1.css" %}">
    <link
     rel="stylesheet"
     href="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/21.2.6/css/intlTelInput.css"
   />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/21.2.6/js/intlTelInput.min.js"></script>
    <link href="https://getbootstrap.com/docs/5.3/assets/css/docs.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Google Tag Manager -->
		<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
			new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
			j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
			'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
			})(window,document,'script','dataLayer','GTM-NBX832CK');</script>
		<!-- End Google Tag Manager -->

    <script type="text/javascript">
      (function(c,l,a,r,i,t,y){
          c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
          t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
          y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
      })(window, document, "clarity", "script", "nqixhxf3g6");
  </script>
</head>
<style>
  #loading-overlay {
      display: none;
      justify-content: center;
      align-items: center;
      position: fixed;
      top: 0;
      right: 0;
      bottom: 0;
      left: 0;
      z-index: 9999;
      background-color: rgba(255, 255, 255, 0.8);
  }
  
  .spinner-container {
      text-align: center; /* Căn giữa nội dung */
  }
  
  .loader {
      border: 4px solid #f3f3f3;
      border-top: 4px solid #3498db;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 2s linear infinite;
  }
  
  @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
  }    
</style>
  <body>
    <div id="loading-overlay">
      <div class="spinner-container">
          <span class="spinner-border spinner-border-md" aria-hidden="true"></span>
          <br>
          <span role="status" class="fw-bold">{% trans "Loading..." %}</span>
          <br>
          <span role="status" class="fw-bold">{% trans "Wait a moment" %}</span>
      </div>
    </div>

    <section>
        <header>
          <a href="{% url "hospitalInfo" hospital_id %}"><img src="{% static "home/arrow-left.svg" %}" alt="Back-arrow" style="width: 22px; height: 22px;"></a>
          <div class="top">
                <h1 class="fs-5">{% trans "Personal Information" %} (1/3)</h1>      
            </div>
            <div style="width: 22px; height: 22px;"> 
            </div>
        </header>


        <main>
            <form class="form" method="POST" id="nextForm"> 
                {% csrf_token %}
                <div class="personal-info">
                    <div class="name">
                      {% if current_language == 'jp' %}
                      <div class="surname">
                        <p>{% trans "Surname" %}</p>
                          <input type="text" name="surname" value="{% if surname %}{{surname}}{% endif %}" placeholder="{% trans "Smith" %}" required>
                      </div>
                      <div class="firstname">
                        <p>{% trans "Firstname" %}</p>
                          <input type="text" name="firstname" value="{% if firstname %}{{firstname}}{% endif %}" placeholder="{% trans "John" %}" required>
                      </div>
                      {% else %}
                        <div class="firstname">
                            <p>{% trans "Firstname" %}</p>
                            <input type="text" name="firstname" value="{% if firstname %}{{firstname}}{% endif %}" placeholder="{% trans "John" %}" required>
                        </div>
                        <div class="surname">
                            <p>{% trans "Surname" %}</p>
                            <input type="text" name="surname" value="{% if surname %}{{surname}}{% endif %}" placeholder="{% trans "Smith" %}" required>
                        </div>
                      {% endif %}
                    </div>
                    <div class="gender">
                        <p>{% trans "Gender" %}</p>
                        <select name="gender" class="form-control" required>
                            <option value="" disabled selected>{% trans "Select Gender" %}</option>
                            <option value="0" {% if gender == False or gender == '0' %}selected{% endif %}>{% trans "Male" %}</option>
                            <option value="1" {% if gender == True or gender == '1' %}selected{% endif %}>{% trans "Female" %}</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <p>{% trans "Date of Birth" %}</p>
                        <input type="date" class="form-control" style="line-height: 2; margin-bottom: 10px;" name="dob" value="{% if dob %}{{dob}}{% endif %}" placeholder="{% trans "Date of Birth" %}" required>
                    </div>

                    <div class="email">
                        <p>{% trans "Email" %}</p>
                        <input type="email" name="email" value="{% if email %}{{email}}{% endif %}" placeholder="example@gmail.com" required>
                    </div>
                    <div class="phone">
                        <p>{% trans "Phone Number" %}</p>
                        <input id="phone" type="text" name="phone" value="{% if phone %}{{phone}}{% endif %}" required/>
                    </div>
                    <input type="hidden" id="phone_country_code" name="phone_country_code" value="{% if phone_country_code %}{{phone_country_code}}{% endif %}">
                </div>
            </form>
        </main>

        <div class="footer">
            <button type="submit" id="book1" style="width: 100%;">{% trans "Next" %}</button>
        </div>
    </section>


    <script>

        document.addEventListener('DOMContentLoaded', function () {
            document.querySelectorAll('.close').forEach(function(link) {
              link.addEventListener('click', function (e) {
                e.preventDefault(); 
                var confirmation = confirm('Are you sure you want to cancel?');
        
                if (confirmation) {
                  var href = this.getAttribute('href'); 
                  window.location.href = href; 
                }
              });
            });
        });

        function showLoading() {
          document.getElementById("loading-overlay").style.display = "flex";
        }
        
        function hideLoading() {
            document.getElementById("loading-overlay").style.display = "none";
        }
    
        function getIp(callback) {
            fetch('https://ipinfo.io/json?token=a16ee956dba5d2', { headers: { 'Accept': 'application/json' }})
                .then((resp) => resp.json())
                .catch(() => {
                    return { country: 'jp' };
                })
                .then((resp) => callback(resp.country.toLowerCase()));
        }
    
        
    </script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
          const phoneInputField = document.querySelector("#phone");
          const phoneCountryCodeInput = document.getElementById('phone_country_code');
          if (phoneCountryCodeInput.value === '') {
            phoneCountryCodeInput.value = '+81';
          }
          
          const initialCountryCode = phoneCountryCodeInput.value ? phoneCountryCodeInput.value.replace('+', '') : 'jp';

          showLoading();
        
          const phoneInput = window.intlTelInput(phoneInputField, {
            preferredCountries: ["jp", "us", "vn", "kr", "ph", "tw"],
            initialCountry: initialCountryCode,
            utilsScript: "https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/21.2.6/js/utils.js",
            autoPlaceholder: "polite",
            separateDialCode: true,
            showSelectedDialCode: true,
            countrySearch: false,
            formatOnDisplay: false,
            customPlaceholder: function(selectedCountryPlaceholder, selectedCountryData) {
              return "e.g. " + selectedCountryPlaceholder;
            }
          });

          phoneInput.promise.then(function() {
            phoneInput.setNumber("{{ phone }}");
            hideLoading();
          });
        
          if (phoneInput.getNumber() === '') {
            phoneInput.setNumber("+" + initialCountryCode);
          }
        
          phoneInputField.addEventListener('countrychange', function() {
            const fullNumber = phoneInput.getNumber();
            const countryCode = phoneInput.getSelectedCountryData().dialCode;
            localStorage.setItem("phone", fullNumber.replace(/-/g, '')); 
            localStorage.setItem("country", phoneInput.getSelectedCountryData().iso2);
            phoneCountryCodeInput.value = "+" + countryCode; 
          });
        
          document.getElementById('book1').addEventListener('click', function() {
            const form = document.getElementById('nextForm');
            if (form.checkValidity()) {
                form.submit();
            } else {
                form.reportValidity(); // Hiển thị thông báo lỗi nếu có
                }
          }); 
        });
    </script>
        
  </body>
  {% if user.is_authenticated and user.patient.is_patient %}
	<noscript>
    <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NBX832CK" height="0" width="0" style="display:none;visibility:hidden"></iframe>
  </noscript>
	{% endif %}
</html>
