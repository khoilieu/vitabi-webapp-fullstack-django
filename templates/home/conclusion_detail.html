
{% load static %}
{% load i18n %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"/>
<link rel="icon" href="{% static "home/favicon.png" %}" type="image/x-icon">
    <title>Conclusion</title>
    <link rel="stylesheet" href="{% static "home/conclusion-detail.css" %}">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <link href="https://getbootstrap.com/docs/5.3/assets/css/docs.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Google Tag Manager -->
		<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
			new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
			j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
			'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
			})(window,document,'script','dataLayer','GTM-NBX832CK');</script>
		<!-- End Google Tag Manager -->

    <script type="text/javascript">
      (function(c,l,a,r,i,t,y){
          c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
          t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
          y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
      })(window, document, "clarity", "script", "nqixhxf3g6");
  </script>
</head>
  <body>
    <section>
        <header>
          {% if request.session.completed %}
          <a href="{% url 'diagnose' conclusion.id %}"><img src="{% static "home/arrow-left.svg" %}" alt="Back-arrow" style="width: 22px; height: 22px;"></a>
          {% else %}
          <br>
          {% endif %}
          <div class="top">
                <h1 class="h1">{% trans "Your result" %}</h1>      
            </div>
            <a href="{% url "home" %}" class="close"><button type="button" class="btn-close" aria-label="Close"></button></a>
        </header>

        <main>
            <div class="results-modal">
                <div class="results-header">
                  <form id="language-form" action="{% url 'change_language' %}" method="post">
                    {% csrf_token %}
                    <input type="hidden" id="next" name="next" value="{{ request.path }}">
                    <div class="language-selection">
                      <button type="submit" name="language" value="en" class="language-option">EN</button>
                      <button type="submit" name="language" value="jp" class="language-option">JP</button>
                      <button type="submit" name="language" value="vn" class="language-option">VN</button>
                    </div>
                  </form>              
                </div>
                <div class="result-item">
                  <div class="conclusion-section" style="margin-right: 10px;">
                    {% if conclusion.odds_condition == '>=1' %}
                      <h3>{% trans "This could be an emergency. People with similar symptoms, usually need to go to the emergency department." %}</h3>
                    {% elif conclusion.odds_condition == '<1' %}
                      <h3>{% trans conclusion.text %}</h3>
                    {% endif %} 
                    {% if conclusion.odds_condition == '>=1' %}
                    {% elif conclusion.odds_condition == '<1' %}
                      {% if conclusion.odds_condition == '>=1' %}
                        <p>{% trans "Hospital visit recommendeds" %}</p>
                      {% elif conclusion.odds_condition == '<1' %}
                        <p>{% trans "Can usually be managed at home" %}</p>
                      {% endif %} 
                    {% endif %} 
                  </div>
                  <div class="percentage-section">
                    <p class="percentage {% if odds <= 25 %}percentage-low{% elif odds > 25 and odds <= 50 %}percentage-medium{% elif odds > 50 and odds <= 80 %}percentage-high{% else %}percentage-very-high{% endif %}">
                      {{ odds }}%
                    </p>
                  </div>
                  <div class="responses">
                    {% if conclusion.odds_condition == '>=1' %}
                      <p style="margin-bottom: 5px !important;">{% trans "Make an appointment for a hospital visit, or if your condition is severe, call an ambulance using the appropriate number in your region." %} </p>
                      <p class="fw-bold">{% trans "Be aware that in some countries, you may be charged for using the ambulance service." %}</p>
                      <hr>
                      <p>{% trans "Advice on coronavirus (COVID-19)" %}</p>
                      <p>{% trans "ー A new, continuous cough" %}</p>
                      <p>{% trans "ー Fever" %}</p>
                      <p>{% trans "ー Difficulty breathing" %}</p>
                      <p>{% trans "ー Loss or change to your sense of taste or smell" %}</p>
                      <p>{% trans "Most people with coronavirus have at least one of these symptoms." %}</p>
                    {% elif conclusion.odds_condition == '<1' %}
                      <p>{% trans "7 out of 10 people with these symptoms had this condition." %}</p>
                      <p>{% trans "People with symptoms similar to yours can usually manage their symptoms safely at home. You could also seek advice by visiting or contacting your local pharmacy. If your symptoms persist longer than expected, if they get worse, or if you notice new symptoms, you should consult a doctor for further assessment and advice." %}</p>
                      <p style="font-weight: bold;">{% trans "Less likely causes" %}</p>
                      <p style="font-weight: bold;">{% trans "ーFlu" %}</p>
                      <p>{% trans "5 out of 1000 people with these symptoms had this condition." %}</p>
                      <p style="font-weight: bold;">{% trans "ーMigraine" %}</p>
                      <p>{% trans "5 out of 1000 people with these symptoms had this condition." %}</p>
                      <p style="font-weight: bold;">{% trans "Suggested Medicines" %}</p>
                      <p>XXXXXXX</p>
                      <p>XXXXXXX</p>
                    {% endif %} 
                  </div>
                </div>
            </div>
        </main>

        <div class="footer">
          <button class="find-hospitals" style="width: 100%;" onclick="window.location='{% url 'findHospital' %}'">{% trans "Find Hospitals" %}</button>
        </div>
    </section>
  </body>
  {% if user.is_authenticated and user.patient.is_patient %}
	<!-- Google Tag Manager (noscript) -->
	<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NBX832CK"
		height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
		<!-- End Google Tag Manager (noscript) -->	
	{% endif %}	
</html>

<script>
  document.addEventListener('DOMContentLoaded', function () {

    document.querySelectorAll('.close').forEach(function(link) {
      link.addEventListener('click', function (e) {
        e.preventDefault(); 
        var confirmation = confirm('Are you sure you want to cancel?');

        if (confirmation) {
          var href = this.getAttribute('href'); 
          window.location.href = href; 
        }
      });
    });
  });

  document.addEventListener('DOMContentLoaded', function () {
    const languageButtons = document.querySelectorAll('.language-option');
    const nextField = document.getElementById('next');
    
    languageButtons.forEach(function(button) {
      button.addEventListener('click', function (e) {
        const currentLangPrefix = window.location.pathname.split('/')[1];
        const chosenLanguage = this.value;
        
        let newLangPrefix = chosenLanguage;
        
        const newPath = window.location.pathname.replace('/' + currentLangPrefix, '/' + newLangPrefix);
        nextField.value = window.location.origin + newPath + window.location.search;
        
        e.preventDefault();
        document.getElementById('language-form').submit();
      });
    });
  });  

  document.addEventListener('DOMContentLoaded', function () {
    const languageButtons = document.querySelectorAll('.language-option');
    languageButtons.forEach(function(button) {
      button.addEventListener('click', function () {
        languageButtons.forEach(button => button.classList.remove('selected'));
        this.classList.add('selected');
      });
    });
  });  
</script>




